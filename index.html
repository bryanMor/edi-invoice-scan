<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice to EDI Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Invoice to EDI Converter</h1>
            <p class="text-gray-600">Upload invoices and convert them to EDI flat file format (Record Type B)</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
            
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center justify-center text-center">
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                    <i data-lucide="upload-cloud" class="text-blue-600"></i>
                </div>
                <h3 class="font-semibold mb-1">Upload PDF</h3>
                <p class="text-xs text-gray-500 mb-4">Drag and drop or click to browse</p>
                <input type="file" id="fileInput" class="hidden" accept=".pdf,.json">
                <button onclick="document.getElementById('fileInput').click()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition">
                    Select File
                </button>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="flex items-center gap-2 mb-4">
                    <i data-lucide="folder" class="w-5 h-5 text-indigo-500"></i>
                    <h3 class="font-semibold">Folders</h3>
                </div>
                <select id="folderSelect" class="w-full p-2 border rounded-md text-sm bg-gray-50">
                    <option>Main Directory</option>
                    <option>Q1 Invoices</option>
                    <option>Vendor Alpha</option>
                </select>
            </div>

            <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="p-4 border-b border-gray-100 bg-gray-50/50">
                    <h3 class="font-semibold text-sm">Recent Conversions</h3>
                </div>
                <div id="historyList" class="max-h-48 overflow-y-auto custom-scrollbar p-2">
                    <p class="text-gray-400 text-sm text-center py-10">No recent activity</p>
                </div>
            </div>
        </div>

        <div id="resultsArea" class="hidden space-y-6">
            <div id="validationAlert" class="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg">
                <div class="flex">
                    <i data-lucide="alert-triangle" class="text-amber-400 mr-3"></i>
                    <div>
                        <p class="text-sm text-amber-700 font-medium">Validation Warnings</p>
                        <ul id="violationList" class="text-xs text-amber-600 list-disc ml-4 mt-1"></ul>
                    </div>
                </div>
            </div>

            <div class="bg-slate-900 rounded-xl shadow-xl overflow-hidden">
                <div class="flex items-center justify-between p-4 bg-slate-800 text-white">
                    <div class="flex items-center gap-2">
                        <i data-lucide="file-code" class="w-5 h-5 text-blue-400"></i>
                        <span class="font-mono text-sm" id="outputFileName">EDI_OUTPUT.txt</span>
                    </div>
                    <button onclick="copyEDI()" class="text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded transition">Copy All</button>
                </div>
                <pre id="ediContent" class="p-6 font-mono text-green-400 text-xs overflow-x-auto whitespace-pre leading-relaxed"></pre>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        const fileInput = document.getElementById('fileInput');
        const historyList = document.getElementById('historyList');
        const resultsArea = document.getElementById('resultsArea');
        const ediContent = document.getElementById('ediContent');
        const violationList = document.getElementById('violationList');

        // Logic shared with your React code
        function convertToEDIFormat(item) {
            const recordType = 'B';
            const upc = (item.upc || '').replace(/[^0-9]/g, '').padStart(11, '0').substring(0, 11);
            const description = (item.description || '').substring(0, 25).padEnd(25, ' ');
            const sku = (item.sku || '').padStart(6, '0').substring(0, 6);
            const priceVal = item.price || 0;
            const casePrice = String(Math.round(priceVal * 100)).padStart(6, '0').substring(0, 6);
            const unitOfMeasure = 'CA';
            const packSize = String(item.pack || 1).padStart(6, '0').substring(0, 6);
            const quantity = String(item.qty || 1).padStart(4, '0').substring(0, 4);
            const fixedZeros = '0000000';
            const fixedOne = '1';

            const line = recordType + upc + description + sku + casePrice + unitOfMeasure + packSize + ' ' + quantity + fixedZeros + fixedOne;
            
            // Basic validation check
            let violations = [];
            if (upc === '00000000000') violations.push(`Item ${item.sku || 'Unknown'}: Missing UPC`);
            
            return { line, violations };
        }

        // Handle File Upload Simulation
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Mocking data extraction since we don't have a PDF parser in a single HTML
            const mockExtractedData = [
                { upc: '12345678901', description: 'CRUNCHY OATS 500G', sku: 'A99', price: 12.50, pack: 12, qty: 5 },
                { upc: '', description: 'WHOLE MILK 1L', sku: 'B22', price: 4.20, pack: 6, qty: 10 }
            ];

            processConversion(file.name, mockExtractedData);
        });

        function processConversion(filename, data) {
            let fullEdi = "";
            let allViolations = [];

            data.forEach(item => {
                const result = convertToEDIFormat(item);
                fullEdi += result.line + "\n";
                allViolations = [...allViolations, ...result.violations];
            });

            // Update UI
            document.getElementById('outputFileName').innerText = filename.replace('.pdf', '.txt');
            ediContent.innerText = fullEdi;
            resultsArea.classList.remove('hidden');

            // Handle Violations
            if (allViolations.length > 0) {
                document.getElementById('validationAlert').classList.remove('hidden');
                violationList.innerHTML = allViolations.map(v => `<li>${v}</li>`).join('');
            } else {
                document.getElementById('validationAlert').classList.add('hidden');
            }

            // Update History
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const historyItem = `
                <div class="flex items-center justify-between p-3 border-b border-gray-50 last:border-0 hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <i data-lucide="file-text" class="w-4 h-4 text-blue-500"></i>
                        <div>
                            <p class="text-sm font-medium">${filename}</p>
                            <p class="text-[10px] text-gray-400">${time} â€¢ ${data.length} records</p>
                        </div>
                    </div>
                    <i data-lucide="check-circle-2" class="w-4 h-4 text-green-500"></i>
                </div>
            `;
            
            if (historyList.querySelector('p')) historyList.innerHTML = '';
            historyList.insertAdjacentHTML('afterbegin', historyItem);
            lucide.createIcons();
        }

        function copyEDI() {
            navigator.clipboard.writeText(ediContent.innerText);
            alert("EDI data copied to clipboard!");
        }
    </script>
</body>
</html>
